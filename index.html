<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>5Ps Job Calculator</title>

    <!-- Tailwind via CDN (embed-friendly) -->
    <script src="https://cdn.tailwindcss.com"></script>

    <style>
      /* Small quality-of-life */
      input[type="number"]::-webkit-outer-spin-button,
      input[type="number"]::-webkit-inner-spin-button {
        -webkit-appearance: none;
        margin: 0;
      }
      input[type="number"] {
        -moz-appearance: textfield;
      }
    </style>
  </head>

  <body class="min-h-screen bg-neutral-950 text-neutral-100">
    <main class="mx-auto max-w-3xl px-4 py-10">
      <header class="mb-8">
        <h1 class="text-3xl font-bold tracking-tight">5Ps Job Calculator</h1>
        <p class="mt-2 text-neutral-300">
          Score each category 1–10. Adjust weights if you want. Get a single job score + decision.
        </p>
      </header>

      <section class="rounded-2xl bg-neutral-900/60 p-5 shadow-lg ring-1 ring-neutral-800">
        <div class="grid gap-4 sm:grid-cols-2">
          <!-- Job Name -->
          <div class="sm:col-span-2">
            <label class="text-sm text-neutral-300">Job / Company Name</label>
            <input
              id="jobName"
              class="mt-1 w-full rounded-xl bg-neutral-950/70 px-4 py-3 text-neutral-100 ring-1 ring-neutral-800 focus:outline-none focus:ring-2 focus:ring-white/40"
              placeholder="e.g., Deloitte — Learning & Development"
            />
          </div>

          <!-- Score Inputs -->
          <div id="scoresWrap" class="sm:col-span-2 grid gap-4 sm:grid-cols-2"></div>

          <!-- Weight Inputs -->
          <div class="sm:col-span-2 mt-2">
            <div class="flex items-center justify-between">
              <h2 class="text-lg font-semibold">Weights</h2>
              <button
                id="resetWeights"
                class="rounded-xl bg-neutral-100 px-3 py-2 text-sm font-semibold text-neutral-900 hover:bg-white"
                type="button"
              >
                Reset defaults
              </button>
            </div>
            <p class="mt-1 text-sm text-neutral-300">
              Weights auto-normalize to 100% if you change them.
            </p>
          </div>

          <div id="weightsWrap" class="sm:col-span-2 grid gap-4 sm:grid-cols-2"></div>

          <!-- Output -->
          <div class="sm:col-span-2 mt-2 rounded-2xl bg-neutral-950/60 p-5 ring-1 ring-neutral-800">
            <div class="flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between">
              <div>
                <p class="text-sm text-neutral-300">Final Score (0–10)</p>
                <p id="finalScore" class="text-4xl font-bold">—</p>
              </div>

              <div class="text-left sm:text-right">
                <p class="text-sm text-neutral-300">Decision</p>
                <p id="decision" class="text-2xl font-semibold">—</p>
                <p id="rule" class="mt-1 text-sm text-neutral-400">
                  8.0+ Strong Yes • 7.0–7.9 Consider • &lt;7 Settling
                </p>
              </div>
            </div>

            <div class="mt-4 flex flex-wrap gap-2">
              <button
                id="copyJson"
                class="rounded-xl bg-white px-4 py-2 text-sm font-semibold text-neutral-900 hover:bg-neutral-200"
                type="button"
              >
                Copy JSON
              </button>
              <button
                id="copyText"
                class="rounded-xl bg-neutral-800 px-4 py-2 text-sm font-semibold text-neutral-100 hover:bg-neutral-700"
                type="button"
              >
                Copy Summary
              </button>
              <button
                id="clearAll"
                class="rounded-xl bg-neutral-950 px-4 py-2 text-sm font-semibold text-neutral-100 ring-1 ring-neutral-700 hover:bg-neutral-900"
                type="button"
              >
                Clear
              </button>
              <span id="toast" class="ml-1 hidden text-sm text-neutral-300"></span>
            </div>
          </div>
        </div>
      </section>

      <footer class="mt-6 text-sm text-neutral-500">
        Tip: Use this for offers too. Any decision becomes easier when you score it.
      </footer>
    </main>

    <script>
      // ===== Config =====
      const DEFAULTS = {
        scores: { pay: 8, passion: 7, problem: 8, place: 7, people: 8 },
        weights: { pay: 30, passion: 15, problem: 20, place: 15, people: 20 },
      };

      const LABELS = {
        pay: { title: "Pay", hint: "Comp, upside, total rewards" },
        passion: { title: "Passion", hint: "Enjoyment + alignment" },
        problem: { title: "Problem", hint: "Do you like solving this?" },
        place: { title: "Place", hint: "Remote, commute, city, vibe" },
        people: { title: "People", hint: "Boss, team, culture, talent" },
      };

      // ===== State =====
      const state = {
        jobName: "",
        scores: { ...DEFAULTS.scores },
        weights: { ...DEFAULTS.weights },
      };

      // ===== Helpers =====
      const $ = (id) => document.getElementById(id);

      function clamp(n, min, max) {
        return Math.max(min, Math.min(max, n));
      }

      function round(n, decimals = 2) {
        const p = Math.pow(10, decimals);
        return Math.round(n * p) / p;
      }

      function normalizeWeights(weightsObj) {
        const keys = Object.keys(weightsObj);
        const sum = keys.reduce((acc, k) => acc + Number(weightsObj[k] || 0), 0);
        if (sum <= 0) return { ...DEFAULTS.weights };
        const normalized = {};
        keys.forEach((k) => {
          normalized[k] = (Number(weightsObj[k] || 0) / sum) * 100;
        });
        return normalized;
      }

      function computeFinalScore() {
        const wNorm = normalizeWeights(state.weights);
        const final =
          (state.scores.pay * (wNorm.pay / 100)) +
          (state.scores.passion * (wNorm.passion / 100)) +
          (state.scores.problem * (wNorm.problem / 100)) +
          (state.scores.place * (wNorm.place / 100)) +
          (state.scores.people * (wNorm.people / 100));
        return round(final, 2);
      }

      function decisionLabel(score) {
        if (score >= 8) return "Strong Yes";
        if (score >= 7) return "Strategic Consider";
        return "Settling";
      }

      function toast(msg) {
        const t = $("toast");
        t.textContent = msg;
        t.classList.remove("hidden");
        clearTimeout(toast._t);
        toast._t = setTimeout(() => t.classList.add("hidden"), 1400);
      }

      async function copyToClipboard(text) {
        try {
          await navigator.clipboard.writeText(text);
          toast("Copied ✅");
        } catch {
          // Fallback
          const ta = document.createElement("textarea");
          ta.value = text;
          document.body.appendChild(ta);
          ta.select();
          document.execCommand("copy");
          document.body.removeChild(ta);
          toast("Copied ✅");
        }
      }

      function buildCard({ key, title, hint, value, onChange, min = 1, max = 10, step = 1 }) {
        const wrap = document.createElement("div");
        wrap.className =
          "rounded-2xl bg-neutral-950/50 p-4 ring-1 ring-neutral-800";

        wrap.innerHTML = `
          <div class="flex items-start justify-between gap-3">
            <div>
              <p class="text-sm text-neutral-300">${title}</p>
              <p class="text-xs text-neutral-500">${hint}</p>
            </div>
            <div class="flex items-center gap-2">
              <button
                data-minus="${key}"
                class="h-9 w-9 rounded-xl bg-neutral-900 text-neutral-100 ring-1 ring-neutral-800 hover:bg-neutral-800"
                type="button"
                aria-label="decrease"
              >−</button>
              <input
                data-input="${key}"
                type="number"
                inputmode="numeric"
                min="${min}"
                max="${max}"
                step="${step}"
                class="w-16 rounded-xl bg-neutral-950/70 px-3 py-2 text-center text-neutral-100 ring-1 ring-neutral-800 focus:outline-none focus:ring-2 focus:ring-white/40"
                value="${value}"
              />
              <button
                data-plus="${key}"
                class="h-9 w-9 rounded-xl bg-neutral-900 text-neutral-100 ring-1 ring-neutral-800 hover:bg-neutral-800"
                type="button"
                aria-label="increase"
              >+</button>
            </div>
          </div>
          <div class="mt-3">
            <input
              data-range="${key}"
              type="range"
              min="${min}"
              max="${max}"
              step="${step}"
              value="${value}"
              class="w-full"
            />
          </div>
        `;

        const input = wrap.querySelector(`[data-input="${key}"]`);
        const range = wrap.querySelector(`[data-range="${key}"]`);
        const minus = wrap.querySelector(`[data-minus="${key}"]`);
        const plus = wrap.querySelector(`[data-plus="${key}"]`);

        function sync(newVal) {
          input.value = newVal;
          range.value = newVal;
          onChange(newVal);
          renderOutput();
        }

        input.addEventListener("input", () => sync(clamp(Number(input.value || 0), min, max)));
        range.addEventListener("input", () => sync(Number(range.value)));
        minus.addEventListener("click", () => sync(clamp(Number(input.value || 0) - step, min, max)));
        plus.addEventListener("click", () => sync(clamp(Number(input.value || 0) + step, min, max)));

        return wrap;
      }

      function buildWeightCard({ key, title, hint, value, onChange }) {
        // weights are % points (0–100)
        const wrap = document.createElement("div");
        wrap.className =
          "rounded-2xl bg-neutral-950/50 p-4 ring-1 ring-neutral-800";

        wrap.innerHTML = `
          <div class="flex items-start justify-between gap-3">
            <div>
              <p class="text-sm text-neutral-300">${title}</p>
              <p class="text-xs text-neutral-500">${hint}</p>
            </div>
            <div class="flex items-center gap-2">
              <input
                data-winput="${key}"
                type="number"
                inputmode="numeric"
                min="0"
                max="100"
                step="1"
                class="w-20 rounded-xl bg-neutral-950/70 px-3 py-2 text-center text-neutral-100 ring-1 ring-neutral-800 focus:outline-none focus:ring-2 focus:ring-white/40"
                value="${value}"
              />
              <span class="text-sm text-neutral-500">%</span>
            </div>
          </div>
          <div class="mt-3">
            <input data-wrange="${key}" type="range" min="0" max="100" step="1" value="${value}" class="w-full" />
          </div>
          <p class="mt-2 text-xs text-neutral-500">
            Normalized weight: <span data-wnorm="${key}">—</span>%
          </p>
        `;

        const input = wrap.querySelector(`[data-winput="${key}"]`);
        const range = wrap.querySelector(`[data-wrange="${key}"]`);

        function sync(newVal) {
          const v = clamp(Number(newVal || 0), 0, 100);
          input.value = v;
          range.value = v;
          onChange(v);
          renderOutput();
        }

        input.addEventListener("input", () => sync(input.value));
        range.addEventListener("input", () => sync(range.value));

        return wrap;
      }

      // ===== Render =====
      function renderInputs() {
        // Scores
        const scoresWrap = $("scoresWrap");
        scoresWrap.innerHTML = "";
        Object.keys(LABELS).forEach((key) => {
          scoresWrap.appendChild(
            buildCard({
              key,
              title: `${LABELS[key].title} (1–10)`,
              hint: LABELS[key].hint,
              value: state.scores[key],
              onChange: (v) => (state.scores[key] = Number(v)),
              min: 1,
              max: 10,
              step: 1,
            })
          );
        });

        // Weights
        const weightsWrap = $("weightsWrap");
        weightsWrap.innerHTML = "";
        Object.keys(LABELS).forEach((key) => {
          weightsWrap.appendChild(
            buildWeightCard({
              key,
              title: `${LABELS[key].title}`,
              hint: "Importance weight",
              value: state.weights[key],
              onChange: (v) => (state.weights[key] = Number(v)),
            })
          );
        });
      }

      function renderOutput() {
        const score = computeFinalScore();
        $("finalScore").textContent = Number.isFinite(score) ? score.toFixed(2) : "—";
        $("decision").textContent = Number.isFinite(score) ? decisionLabel(score) : "—";

        // show normalized weights under each card
        const norm = normalizeWeights(state.weights);
        Object.keys(norm).forEach((k) => {
          const el = document.querySelector(`[data-wnorm="${k}"]`);
          if (el) el.textContent = round(norm[k], 1).toFixed(1);
        });
      }

      // ===== Actions =====
      function getPayload() {
        const norm = normalizeWeights(state.weights);
        const final = computeFinalScore();
        return {
          jobName: state.jobName || "",
          scores: { ...state.scores },
          weights_raw: { ...state.weights },
          weights_normalized: Object.fromEntries(
            Object.entries(norm).map(([k, v]) => [k, round(v, 2)])
          ),
          finalScore: final,
          decision: decisionLabel(final),
          updatedAt: new Date().toISOString(),
        };
      }

      function getSummaryText() {
        const p = getPayload();
        return [
          `5Ps Job Score — ${p.jobName || "(unnamed job)"}`,
          `Final: ${p.finalScore.toFixed(2)} / 10  →  ${p.decision}`,
          ``,
          `Scores: Pay ${p.scores.pay}, Passion ${p.scores.passion}, Problem ${p.scores.problem}, Place ${p.scores.place}, People ${p.scores.people}`,
          `Weights (normalized %): Pay ${p.weights_normalized.pay}, Passion ${p.weights_normalized.passion}, Problem ${p.weights_normalized.problem}, Place ${p.weights_normalized.place}, People ${p.weights_normalized.people}`,
        ].join("\n");
      }

      // ===== Init =====
      renderInputs();
      renderOutput();

      $("jobName").addEventListener("input", (e) => {
        state.jobName = e.target.value || "";
      });

      $("resetWeights").addEventListener("click", () => {
        state.weights = { ...DEFAULTS.weights };
        renderInputs();
        renderOutput();
        toast("Weights reset");
      });

      $("copyJson").addEventListener("click", () => {
        copyToClipboard(JSON.stringify(getPayload(), null, 2));
      });

      $("copyText").addEventListener("click", () => {
        copyToClipboard(getSummaryText());
      });

      $("clearAll").addEventListener("click", () => {
        state.jobName = "";
        state.scores = { ...DEFAULTS.scores };
        state.weights = { ...DEFAULTS.weights };
        $("jobName").value = "";
        renderInputs();
        renderOutput();
        toast("Cleared");
      });
    </script>
  </body>
</html>
